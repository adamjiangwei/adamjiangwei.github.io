<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>Adam的小窝</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f4f9; color:#000; transition: all 0.3s; }
  body.dark { background:#181818; color:#f0f0f0; }
  header { background:#333; color:#fff; padding:10px 20px; display:flex; justify-content:space-between; align-items:center; transition: all 0.3s;}
  header.dark { background:#222; }
  header h1 { margin:0; font-size:20px; }
  .menu { position:relative; }
  .menu > button, #nightToggle { background:#444; color:#fff; border:none; padding:8px 12px; cursor:pointer; border-radius:4px; margin-left:5px; }
  .dropdown { display:none; position:absolute; right:0; top:40px; background:#fff; color:#333; min-width:200px; padding:15px; border-radius:6px; box-shadow:0 2px 6px rgba(0,0,0,0.2); transition: all 0.3s; }
  .dropdown.dark { background:#333; color:#f0f0f0; }
  .dropdown input { width:100%; padding:6px; margin:6px 0; border:1px solid #ccc; border-radius:4px; }
  .dropdown button { width:100%; padding:8px; background:#333; color:#fff; border:none; border-radius:4px; cursor:pointer; }
  .container { padding:20px; max-width:800px; margin:auto; }
  #postForm { display:none; background:#fff; padding:15px; border-radius:8px; margin-bottom:20px; box-shadow:0 2px 4px rgba(0,0,0,0.1); transition: all 0.3s;}
  #postForm.dark { background:#222; }
  #postForm textarea { width:100%; height:80px; padding:10px; margin-bottom:10px; border:1px solid #ccc; border-radius:6px; background:#fff; color:#000; }
  #postForm.dark textarea { background:#333; color:#f0f0f0; border:1px solid #555; }
  #postForm button { padding:8px 16px; border:none; background:#28a745; color:#fff; border-radius:4px; cursor:pointer; }
  .post { background:#fff; padding:15px; border-radius:8px; margin-bottom:20px; box-shadow:0 2px 4px rgba(0,0,0,0.1); transition: all 0.3s;}
  .post.dark { background:#222; }
  .post time { color:#888; font-size:12px; }
  .post .actions button { margin-right:6px; padding:4px 8px; font-size:12px; border:none; border-radius:4px; cursor:pointer; }
  .post .actions .delete { background:#dc3545; color:#fff; }
  .post .actions .edit { background:#ffc107; color:#000; }
  .comments { margin-top:15px; padding-top:10px; border-top:1px solid #ddd; }
  .comment { font-size:14px; padding:6px 0; border-bottom:1px dashed #ddd; }
  .comment:last-child { border-bottom:none; }
  .comment-form input { width:80%; padding:6px; border:1px solid #ccc; border-radius:4px; }
  .comment-form button { padding:6px 12px; margin-left:5px; border:none; background:#007bff; color:#fff; border-radius:4px; cursor:pointer; }
  body.dark .comment-form input { background:#333; color:#f0f0f0; border:1px solid #555; }
  body.dark .post time, body.dark .comment { color:#ccc; }
</style>
</head>
<body>
<header>
  <h1>发布</h1>
  <div class="menu">
    <button onclick="toggleDropdown()">登录</button>
    <div class="dropdown" id="loginBox">
      <input type="text" id="username" placeholder="账号">
      <input type="password" id="password" placeholder="密码">
      <button onclick="login()">登录</button>
    </div>
    <button id="nightToggle" onclick="toggleNight()">夜间模式</button>
  </div>
</header>
<div class="container">
  <div id="postForm">
    <textarea id="postContent" placeholder="写点什么..."></textarea><br>
    <button onclick="publishPost()">发布</button>
  </div>
  <div id="posts"></div>
</div>
<script>
const loginBox = document.getElementById("loginBox");
const postForm = document.getElementById("postForm");
const postsDiv = document.getElementById("posts");
let darkMode = false;

function toggleDropdown(){ loginBox.style.display = loginBox.style.display==="block"?"none":"block"; }

function login(){
  const u=document.getElementById("username").value;
  const p=document.getElementById("password").value;
  if(u&&p){ alert("登录成功:"+u); loginBox.style.display="none"; postForm.style.display="block"; } 
  else alert("请输入账号和密码");
}

function toggleNight(){
  darkMode = !darkMode;
  document.body.classList.toggle("dark", darkMode);
  loginBox.classList.toggle("dark", darkMode);
  postForm.classList.toggle("dark", darkMode);
  Array.from(document.getElementsByClassName("post")).forEach(p=>p.classList.toggle("dark", darkMode));
}

function loadPosts(){
  postsDiv.innerHTML="";
  let posts = JSON.parse(localStorage.getItem("posts")||"[]");
  posts.sort((a,b)=>b.time-a.time);
  posts.forEach(post=>{
    let postDiv=document.createElement("div");
    postDiv.className="post"+(darkMode?" dark":"");
    postDiv.innerHTML=`
      <div class="content">${post.content}</div>
      <time>${new Date(post.time).toLocaleString()}</time>
      <div class="actions">
        <button class="edit" onclick="editPost(${post.time})">编辑</button>
        <button class="delete" onclick="deletePost(${post.time})">删除</button>
      </div>
      <div class="comments">
        ${post.comments.map(c=>`<div class="comment">${c}</div>`).join("")}
        <div class="comment-form">
          <input type="text" id="cmt-${post.time}" placeholder="匿名留言">
          <button onclick="addComment(${post.time})">提交</button>
        </div>
      </div>`;
    postsDiv.appendChild(postDiv);
  });
}

function publishPost(){
  let content=document.getElementById("postContent").value.trim();
  if(!content) return;
  let posts=JSON.parse(localStorage.getItem("posts")||"[]");
  posts.push({content:content,time:Date.now(),comments:[]});
  localStorage.setItem("posts",JSON.stringify(posts));
  document.getElementById("postContent").value="";
  loadPosts();
}

function addComment(time){
  let input=document.getElementById("cmt-"+time);
  let txt=input.value.trim();
  if(!txt) return;
  let posts=JSON.parse(localStorage.getItem("posts")||"[]");
  let post=posts.find(p=>p.time===time);
  if(post){ post.comments.push(txt); localStorage.setItem("posts",JSON.stringify(posts)); loadPosts(); }
}

function deletePost(time){
  if(!confirm("确认删除文章?")) return;
  let posts=JSON.parse(localStorage.getItem("posts")||"[]");
  posts = posts.filter(p=>p.time!==time);
  localStorage.setItem("posts",JSON.stringify(posts));
  loadPosts();
}

function editPost(time){
  let posts=JSON.parse(localStorage.getItem("posts")||"[]");
  let post=posts.find(p=>p.time===time);
  if(post){
    let newContent=prompt("编辑文章内容:",post.content);
    if(newContent!==null){ post.content=newContent.trim(); localStorage.setItem("posts",JSON.stringify(posts)); loadPosts(); }
  }
}

loadPosts();
</script>
</body>
</html>
